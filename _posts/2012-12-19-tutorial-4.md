---
layout: post
title: "Sencha Touch Tutorial: メモ帳アプリを作る #4"
categories: tutorial
css: jp-post
---

<a href="/public/images/i-memo-app-tutorial2.png"><img src="/public/images/i-memo-app-tutorial2.png" alt="" title="i-memo-app-tutorial" width="601" height="261" class="aligncenter size-full wp-image-564" /></a>



<a href="http://www.adventar.org/calendars/23">Sencha Advent Calendar 2012</a> の19日目の記事です。



<a href="http://kawanoshinobu.com/2012/12/tutorial-3/">前回</a>のエントリで、一覧画面を作成しました。今回は、作成画面を作り、タイトルバー右上の「+」ボタンを押して、作成画面に遷移できるようにします。



<!--more-->

<h2><strong>作成画面を作る</strong></h2>

まずは、ナビゲーションビューに作成ボタンを作りましょう。view ディレクトリの Main.js に以下の記述を加えて下さい。



navigationBar オプション（1）の items オプションに button コンポーネントを定義します（2）。「add」アイコンを利用（3）し、配置は右寄せ（4）にしています。また、action プロパティに「add」と指定します。この値は後ほど、コントローラで利用します。（5）



<pre><code>Ext.define('Memo.view.Main', {
    extend: 'Ext.navigation.View',
    xtype: 'main',
    requires: [
    ],
    config: {
        navigationBar: {                 // 1
            items: {
                xtype: 'button',         // 2
                ui: 'flat',
                iconCls: 'add',          // 3
                iconMask: true,
                align: 'right',          // 4
                action: 'add'            // 5
            }
        },
        items: [
            ...
        ]
    }
});
</code></pre>

ブラウザをリロードして、アプリを更新して下さい。バーの右上に「+」ボタンが表示されました。



<a href="/public/images/b-t-6.png"><img src="/public/images/b-t-6.png" alt="" title="b-t-6" width="320" height="530" class="alignnone size-full wp-image-522" /></a>



このボタンをタップして、作成画面に遷移するようにします。遷移処理を記述する前に、作成画面のビューが必要ですね。view ディレクトリの下に Form.js というファイルを作成します。作成したファイルに、以下の内容を記述します。



<pre><code>Ext.define('Memo.view.Form', {
    extend: 'Ext.form.Panel',           // 1
    xtype: 'memoform',                  // 2
    config: {
        items: {
            xtype: 'textareafield',     // 3
            name: 'memo',               // 4
            height: 800                 // 5
        }
    }
});
</code></pre>

「Ext.form.Panel」クラスを継承します（1）。xtype は「memoform」とします（2）。items オプションに textareafield コンポーネントを配置します（3）。name オプションに「memo」（4）、height オプションに「800」を指定します（5）。



また、Form.js ファイルをアプリケーションで利用するため app.js の views オプションにクラスを追加します。（1）



<pre><code>Ext.application({
    name: 'Memo',

    requires: [
        'Ext.MessageBox'
    ],

    views: ['Main', 'List', 'Form'],    // 1

    icon: {
</code></pre>

続いて、ボタンをタップした際に、作成画面に遷移するようにします。遷移処理はコントローラが担います。Sencha Cmd を使って、コントローラの雛形を作成しましょう。コンソールでアプリケーションのディレクトリに移動し、以下のコマンドを、実行して下さい。



<pre><code>$ sencha generate controller -n Memo
</code></pre>

controller ディレクトリに Memo.js というコントローラクラスのファイルが作成されます。また、今まで手動で行っていた app.js の利用宣言もコマンドが行ってくれます。app.js の controllers オプションにクラスが追加されていることを確認してみて下さい。（1）



<pre><code>Ext.application({
    controllers: ["Memo"],             // 1

    name: 'Memo',

    requires: [
        'Ext.MessageBox'
    ],

    views: ['Main', 'List', 'Form'],

    icon: {
        ...
</code></pre>

それでは、タップした際の処理を記述しましょう。controller ディレクトリに生成された Memo.js ファイルを以下のように更新します。



<pre><code>Ext.define('Memo.controller.Memo', {
    extend: 'Ext.app.Controller',

    config: {
        refs: {
            main: 'main'                      // 1
        },
        control: {
            'button[action=add]': {           // 2
                tap: 'onAddButtonTap'
            }
        }
    },

    //called when the Application is launched, remove if not needed
    launch: function(app) {

    },

    onAddButtonTap: function() {              // 3
        this.getMain().push({                 // 4
            xtype: 'memoform'                 // 5
        });
    }

});
</code></pre>

コントローラクラスには、refs と control という、2つの主要な機能があります。refs は、コンポーネントの別名を定義し、コントローラ内でコンポーネントを扱い易くします。control は、コンポーネントのイベントリスナーを定義します。



まず、refs オプションで、main コンポーネントへの参照を定義します（1）。続いて control オプションで、「add」アクションがタップされた際のイベントリスナーを定義します（2）。



イベントハンドラとなる onAddButtonTap メソッドを定義します（3）。this.get{$refsキーのアッパーキャメルケース}で、コンポーネントを取得できます。ここでは、main コンポーネントを取得し、push メソッドを使って画面の切り替えを行います（4）。引数に渡すコンフィグオプションの xtype に、先ほど作成した作成画面の xtype 「memoform」を指定します。（5）



ファイルを保存して、ブラウザをリロードし、アプリを再表示します。右上の「+」ボタンをタップすると、、スライドのアニメーションとともに、作成画面に遷移しましたね！



<a href="/public/images/b-t-7.png"><img src="/public/images/b-t-7.png" alt="" title="b-t-7" width="320" height="530" class="alignnone size-full wp-image-523" /></a>



ナビゲーションビューの機能で、戻るボタンが自動的に追加されています。戻るボタンのキャプションを「Back」ではなく、「メモ」となるよう、Main.js に useTitleForBackButtonText オプションを加えて下さい。（1）



<pre><code>Ext.define('Memo.view.Main', {
    extend: 'Ext.navigation.View',
    xtype: 'main',
    requires: [
    ],
    config: {
        useTitleForBackButtonText: true,     // 1
        navigationBar: {
            items: {
                xtype: 'button',
                ...
        ...
    }
});
</code></pre>

useTitleForBackButtonText　に true を指定することで、遷移前の画面タイトルを、戻るボタンのキャプションにすることができます。<a href="http://kawanoshinobu.com/2012/12/tutorial-5/">次回</a>は、データの保存や更新、削除処理を実装しましょう。



さて、明日の <a href="http://www.adventar.org/calendars/23">Sencha Advent Calendar</a> は、<a href="https://twitter.com/zoetro">@zoetro</a> さんです。「Sencha Touch と TypeScript で何か書きます」とのことで、とてもわくわくしています（´∀｀ ）どうぞよろしくお願いします〜！


