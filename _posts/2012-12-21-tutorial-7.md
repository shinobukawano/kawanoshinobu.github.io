---
layout: post
title: "Sencha Touch Tutorial: メモ帳アプリを作る #7"
categories: tutorial
css: jp-post
---

<img src="/public/images/i-memo-app-tutorial2.png" alt="" title="i-memo-app-tutorial" width="601" height="261" class="aligncenter size-full wp-image-564" />



<a href="http://kawanoshinobu.com/2012/12/tutorial-6/">前回</a>までで、アプリの基本的な機能は完成しました。今回は最終回ということで、デザインやデプロイなど、アプリの仕上げを行います。



<!--more-->

<h2><strong>デザイン</strong></h2>

今出来ているアプリは、見た目だけだと、いかにも「Sencha Touch で作りました」といった雰囲気を漂わせていて、イマイチですよね。これを、iOS のメモ帳アプリ風の見た目に変更します。



Sencha Touch には、見た目をカスタマイズするテーマシステムがあります。テーマシステムは、主に二つの機能があります。



<ul>
<li>変数</li>
<li>ミックスイン</li>
</ul>

それぞれ解説します。



<h3><strong>変数</strong></h3>

Sencha Touch で利用する CSS は、Sass という CSS のプリプロセッサを使って作成します。Sass の記法で書いたファイルをコンパイルして、アプリの CSS を生成する、という流れです。このコンパイル時に、カスタマイズ用の変数が指定されていた場合は、その変数を利用して出力する CSS を変更します。



<h3><strong>ミックスイン</strong></h3>

ミックスインは、プログラムでいう関数のようなものです。ミックスイン自体は、Sass の機能ですが、Sencha Touch には、アプリをカスタマイズするためのミックスインが多数用意されています。このミックスインを利用して、ボタンやツールバーのテーマを作成します。



<h3>app.scss <strong>ファイルの変更</strong></h3>

まず、main コンポーネントにクラス名を付与します。cls オプションを使って、「memo」というクラス名を指定します（1）。これで、生成されるコンポーネントの DOM エレメントの class に、「memo」が設定されるようになりました。



<pre><code>Ext.define('Memo.view.Main', {
    extend: 'Ext.navigation.View',
    xtype: 'main',
    requires: [
    ],
    config: {
        cls: 'memo',                       // 1
        useTitleForBackButtonText: true,

});
</code></pre>

続いて、resources の sass ディレクトリにあるカスタマイズ用の app.scss ファイルを変更します。



<pre><code>@import 'sencha-touch/default/all';

$list-active-color: #663434;                                   // 1

// You may remove any of the following modules that you
// do not use in order to create a smaller css file.
@include sencha-panel;
@include sencha-buttons;
@include sencha-sheet;
@include sencha-picker;
@include sencha-tabs;
@include sencha-toolbar;
@include sencha-toolbar-forms;
@include sencha-indexbar;
@include sencha-list;
@include sencha-layout;
@include sencha-carousel;
@include sencha-form;
@include sencha-msgbox;

// Your custom code goes here...
.memo {                                                                 // 2
    background-image: url('../images/memo-bg.png');

    .x-list, .x-field, .x-layout-card-item,
    .x-scroll-container, .x-form-inner {
        background-color: transparent;
    }
}

@include sencha-toolbar-ui('memo', #331a1a, 'glossy');                  // 3
@include sencha-toolbar-ui('memo-transparent', #fff, 'glossy');         // 4

.x-toolbar-memo-transparent {                                           // 5
    background-color: transparent;
    background-image: none;
}

@include sencha-button-ui('memo', #331a1a, 'glossy');                   // 6
</code></pre>

list-active-color 変数を利用して、リストの選択色を #663434 に変更します（1）。続いて、memo クラスの要素に対してスタイルを指定します。ここでは、background-image にメモ帳風の背景画像を指定して、他の要素が背景画像を上書きしないよう、background-color を transparent にしています。（2）



ミックスインを利用して、ツールバーのテーマを作成します。ひとつは、「memo」という名称で、#331a1a をベースにした色合いにします（3）。透明のツールバーのテーマとして「memo-transparent」を作成します（4）。ミックスインだけでは透明にできないため、加えて別のスタイルも作成します（5）。最後に、「memo」という名称のボタンのテーマを作成します。ツールバーと同じく、#331a1a をベースにした色合いにします。（6）



Sass をコンパイルするには、<a href="http://sass-lang.com/">Sass</a> と <a href="http://compass-style.org/">Compass</a> という Ruby 製のツールをインストールする必要があります。インストールした後、プロジェクトのルートディレクトリで、以下のコマンドを実行して下さい。



<pre><code>$ compass compile resources/sass/

overwrite resources/sass/../css/app.css
</code></pre>

resource の css ディレクトリに app.css というファイルが生成されました。作成したテーマを利用するため、JavaScript の記述を変更します。



<pre><code>Ext.define('Memo.view.Main', {
    extend: 'Ext.navigation.View',
    xtype: 'main',
    requires: [
    ],
    config: {
        cls: 'memo',
        useTitleForBackButtonText: true,
        navigationBar: {
            ui: 'memo',
            items: {
                xtype: 'button',
                ui: 'memo',                     // 1
                iconCls: 'add',
                iconMask: true,
                action: 'add',
                align: 'right'
            }
        },
</code></pre>

main コンポーネントの navigationBar の ui オプションを memo に変更します。（1）



<pre><code>Ext.define('Memo.view.Form', {
    extend: 'Ext.form.Panel',
    xtype: 'memoform',
    config: {
        items: [
            {
                xtype: 'textareafield',
                name: 'memo',
                height: 800
            },
            {
                xtype: 'toolbar',
                docked: 'bottom',
                ui: 'memo-transparent',          // 2
                items: [
                    {
                        xtype: 'spacer'
                    },
                    {
                        xtype: 'button',
                        ui: 'memo',               // 3
                        iconCls: 'trash',
                        iconMask: true,
                        action: 'remove'
                    }
                ]
            }
        ]
    }
});
</code></pre>

memoform コンポーネントの toolbar コンポーネントの ui を memo-transparent に変更します（2）。また、button コンポーネントの ui を memo に変更します。（3）



ブラウザをリロードして、アプリを更新して下さい。



一覧画面



<a href="/public/images/b-t-12.png"><img src="/public/images/b-t-12.png" alt="" title="b-t-12" width="320" height="530" class="alignnone size-full wp-image-571" /></a>



フォーム画面



<a href="/public/images/b-t-13.png"><img src="/public/images/b-t-13.png" alt="" title="b-t-13" width="320" height="530" class="alignnone size-full wp-image-572" /></a>



iOS のメモ帳アプリ風な見た目に変更されましたね！長くなってきたので、最終回、<a href="http://kawanoshinobu.com/2012/12/tutorial-final/">次回</a>に続きます... Σ(ﾟДﾟ)



