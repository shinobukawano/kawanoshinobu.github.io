---
layout: post
title: "Sencha Touch Tutorial: メモ帳アプリを作る #2"
categories: tutorial
css: jp-post
---

<img src="/public/images/i-memo-app-tutorial2.png" alt="" title="i-memo-app-tutorial" width="601" height="261" class="aligncenter size-full wp-image-562" />



<a href="http://www.adventar.org/calendars/23">Sencha Advent Calendar 2012</a> の2日目の記事です。



<a href="http://shinobukawano.com/2012/12/tutorial-1/">前回</a>、Sencha Touch の開発を始めるために必要な準備を行いました。今回からは、具体的にソースコードを記述していきましょう。



<!--more-->

これから、iOS で標準インストールされている「メモ帳」アプリとそっくりなアプリを作成します。このアプリは、WEB ブラウザだけでなく、iPhone、Android のネイティブアプリとして動作する想定です。



<h2><strong>プロジェクトの俯瞰</strong></h2>

前回作成したプロジェクトの構成を、俯瞰してみましょう。



<pre><code>$ cd apps/memo/
$ tree

.
├── app
│   ├── controller
│   ├── model
│   ├── profile
│   ├── store
│   └── view
├── resources
│   ├── css
│   ├── icons
│   ├── loading
│   ├── sass
│   └── startup
└── touch
    ...
├── app.js
├── app.json
├── build.xml
├── index.html
└── packager.json
</code></pre>

「app」ディレクトリは、アプリケーションのソースコードを配置するディレクトリです。Sencha Touch のアプリは、Model、View、Controller、store、profile という 5 つの要素で構成されます。Sencha Cmd で生成したプロジェクトでは、それぞれのソースコードを配置するためのディレクトリが用意されています。



「resources」ディレクトリは、css や画像などのリソースファイルを配置するためのディレクトリです。また、css にコンパイルするための .scss ファイルは、このディレクトリに配置します。



「touch」ディレクトリは、ライブラリのコピーが配置されたディレクトリです。アプリケーションが依存するファイルをこのディレクトリから読み込みます。



「app.js」ファイルは、アプリケーションの準備を行う処理（Ext.application）が記述されたファイルです。



「app.json」ファイルは、ビルド用の設定を定義するファイルです。



「build.xml」ファイルは、ビルドを行う Ant のタスクを定義するファイルです。



「index.html」ファイルは、アプリケーションを配置するページのファイルです。



「packager.json」ファイルは、ネイティブアプリにパッケージングする際に必要になる定義ファイルです。



それぞれの詳細は、必要な時に改めて解説します。


<h2>Hello, World!</h2>

それでは、プログラミング入門の慣習に従って、「Hello, World!」メッセージを表示してみましょう。「app.js」ファイルに記述されている launch 関数は、アプリケーションの準備が整った後に呼ばれる関数です。起動時に行う処理を記述するには最適の場所です。ここに、メッセージを表示するコードを記述します。



<pre><code>launch: function() {
    // Destroy the #appLoadingIndicator element
    Ext.fly('appLoadingIndicator').destroy();

    // Initialize the main view
    Ext.Viewport.add(Ext.create('Memo.view.Main'));

    // ここに追加します
    Ext.Msg.alert('タイトル', 'Hello, World!');
},
</code></pre>

アプリケーションのページを再読み込みして下さい。メッセージが表示されましたね。



<a href="/public/images/t-2-1.png"><img src="/public/images/t-2-1.png" alt="" title="t-2-1" width="320"  class="alignnone size-full wp-image-214" /></a>



Ext.Msg は、メッセージダイアログを表示するためのシングルトンインスタンスです。実行できるメソッドの詳細は、API ドキュメントを参照して下さい。ライブラリにドキュメントが含まれていますが、WEB 上でも公開されています。Sencha Touch 2.1 ドキュメントページの URL は以下です。



<strong>Touch 2.1 - Sencha Docs</strong>



<a href="http://docs.sencha.com/touch/2-1/">http://docs.sencha.com/touch/2-1/</a>



<h2>Ext.Viewport</h2>

では改めて、app.js の launch 関数を見てみましょう。



<pre><code>launch: function() {
    ...

    // Initialize the main view
    Ext.Viewport.add(Ext.create('Memo.view.Main'));

},
</code></pre>

Ext.Viewport というシングルトンインスタンスに、Memo.view.Main コンポーネントを追加しています。



アプリケーションの準備が整うと、ページ全体のコンテナとして、Ext.Viewport クラスのシングルトンインスタンスが生成されます。この Ext.Viewport に追加することで初めて、Memo.view.Main コンポーネントが画面上に姿を現します。



また Viewport に追加する前に、Ext.create メソッドを使って、Memo.view.Main クラスのインスタンスを生成しています。Memo.view.Main クラスの定義は、app/view/Main.js ファイル内で行われています。



<pre><code>Ext.define('Memo.view.Main', {
    extend: 'Ext.tab.Panel',
    xtype: 'main',
    requires: [
        ...
    ],
    config: {
        ...
    }
});
</code></pre>

ここまで説明してきたなかで、「クラス」「インスタンス」「シングルトン」といった用語が出てきました。Sencha Touch は、所謂「クラスベースのオブジェクト指向プログラミング」でコードを組み立てられるよう、独自のシステムを構築しています。この独自のシステムが、「Sencha Touch は、とっつきにくい」と感じる原因のひとつかもしれません。



実はこの後、クラスシステムの解説を始めたら、収集がつかなくなってしまった（記事５回分くらいになったw）ので、本連載では、割愛します。。クラスシステムについては、また別枠で解説しますので、チュートリアルでは、雰囲気だけ感じ取って下さい。



<a href="http://shinobukawano.com/2012/12/tutorial-3/">次回</a>は、画面を作っていきましょう！



そして、<a href="http://www.adventar.org/calendars/23">Sencha Advent Calendar</a> ですが、明日は <a href="https://twitter.com/dsuket">@dsuket</a> さんです。いつも私の無茶振りを、笑顔（と思ってる）で引き受けてくれてありがとうございます。明日は、どうぞよろしくお願いします。



